;jQuery.fn.orTree=function(t){var e=$.extend({'onSelect':function(){},'type':'root','id':0,'extraId':Array(),'selectable':Array()},t);$(this).each(function(r,t){$(t).closest('div.content').addClass('loader');var i='./api/?action=tree&subaction=loadBranch&id='+e.id+'&type='+e.type+'&output=json';if(typeof e.extraId==='string'){jQuery.each(jQuery.parseJSON(e.extraId),function(e,t){i=i+'&'+e+'='+t})}
else if(typeof e.extraId==='object'){jQuery.each(e.extraId,function(e,t){i=i+'&'+e+'='+t})}
else{};$.getJSON(i,function(a){$(t).append('<ul class="tree"/>');var r=$(t).children('ul').first(),i=a['output'];$.each(i['branch'],function(a,t){if(!t.action||t.action=='folder'||e.selectable.length==0||e.selectable[0]==''||jQuery.inArray(t.action,e.selectable)!=-1){var i=$('<li class="object" data-id="'+t.internalId+'" data-type="'+t.type+'"><div class="tree"><div class="arrow"></div></div><a href="./?action='+t.type+'&id='+t.internalId+'" class="entry" data-extra="'+JSON.stringify(t.extraId).replace(/"/g,'\'')+'" data-id="'+t.internalId+'" data-type="'+t.type+'" title="'+t.description+'"><img src="modules/cms-ui/themes/default/images/icon_'+t['icon']+'.png" />'+t.text+'</a></li>');$(r).append(i);if(t.type){$(i).children('div.tree').addClass('closed').find('.arrow').addClass('arrow-right');$(i).children('div.tree').click(function(){$(this).parent().orTree({type:t.type,id:t.internalId,extraId:t.extraId,onSelect:e.onSelect,selectable:e.selectable})})};if(t.action&&(e.selectable.length==0||e.selectable[0]==''||jQuery.inArray(t.action,e.selectable)!=-1)){$(i).children('.entry').click(function(a){a.preventDefault();$(this).closest('div.content').find('.entry').removeClass('selected');$(this).addClass('selected');e.onSelect($(this).text(),t.action,t.id,t.extraId)})};if($(i).parents('ul.tree').length<=1){$(i).children('div.tree').click()}}});$(r).slideDown('fast')}).fail(function(){}).always(function(){$(t).closest('div.content').removeClass('loader')});$(t).children('div.tree').unbind('click');$(t).children('div.tree').removeClass('closed').addClass('open').find('.arrow').removeClass('arrow-right').addClass('arrow-down');$(t).children('div.tree').click(function(t){a($(t.delegateTarget).parent(),e.type,e.id,e.extraId)})});function a(t,a,r,i){$(t).children('ul').slideUp('fast',function(){$(t).children('ul').remove();$(t).children('div.tree').unbind('click');$(t).children('div.tree').removeClass('open').addClass('closed').find('.arrow').removeClass('arrow-down').addClass('arrow arrow-right');$(t).children('div.tree').click(function(){$(this).parent().orTree({type:a,id:r,extraId:i,onSelect:e.onSelect,selectable:e.selectable})})})}};