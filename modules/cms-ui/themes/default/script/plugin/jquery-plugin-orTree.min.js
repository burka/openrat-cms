;jQuery.fn.orTree=function(t){var e=$.extend({'onSelect':function(){},'type':'root','id':0,'extraId':Array(),'selectable':Array()},t);$(this).each(function(n,t){$(t).closest('div.content').addClass('loader');var c='./api/?action=tree&subaction=loadBranch&id='+e.id+'&type='+e.type+'&output=json';if(typeof e.extraId==='string'){jQuery.each(jQuery.parseJSON(e.extraId),function(e,t){c=c+'&'+e+'='+t})}
else if(typeof e.extraId==='object'){jQuery.each(e.extraId,function(e,t){c=c+'&'+e+'='+t})}
else{};$.getJSON(c,function(i){$(t).append('<ul class="tree"/>');var n=$(t).children('ul').first(),c=i['output'];$.each(c['branch'],function(i,t){if(!t.action||t.action=='folder'||e.selectable.length==0||e.selectable[0]==''||jQuery.inArray(t.action,e.selectable)!=-1){var c=$('<li class="object" data-id="'+t.internalId+'" data-type="'+t.type+'"><div class="tree">&nbsp;</div><div class="entry" data-extra="'+JSON.stringify(t.extraId).replace(/"/g,'\'')+'" data-id="'+t.internalId+'" data-type="'+t.type+'" title="'+t.description+'"><img src="modules/cms-ui/themes/default/images/icon_'+t['icon']+'.png" />'+t.text+'</div></li>');$(n).append(c);if(t.type){$(c).children('div.tree').addClass('closed');$(c).children('div.tree').click(function(){$(this).parent().orTree({type:t.type,id:t.internalId,extraId:t.extraId,onSelect:e.onSelect,selectable:e.selectable})})};if(t.action&&(e.selectable.length==0||e.selectable[0]==''||jQuery.inArray(t.action,e.selectable)!=-1)){$(c).children('div.entry').click(function(){$(this).closest('div.content').find('div.entry').removeClass('selected');$(this).addClass('selected');e.onSelect($(this).text(),t.action,t.id,t.extraId)})};if($(c).parents('ul.tree').length<=1){$(c).children('div.tree').click()}}});$(n).slideDown('fast')}).fail(function(){}).always(function(){$(t).closest('div.content').removeClass('loader')});$(t).children('div.tree').unbind('click');$(t).children('div.tree').removeClass('closed').addClass('open');$(t).children('div.tree').click(function(t){i($(t.target).parent(),e.type,e.id)})});function i(t,i,n){$(t).children('ul').slideUp('fast',function(){$(t).children('ul').remove();$(t).children('div.tree').unbind('click');$(t).children('div.tree').removeClass('open').addClass('closed');$(t).children('div.tree').click(function(){$(this).parent().orTree({type:i,id:n,onSelect:e.onSelect,selectable:e.selectable})})})}};