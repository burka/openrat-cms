;Openrat.Form=function(){this.setLoadStatus=function(t){$(this.element).closest('div.content').toggleClass('loader',t)};this.initOnElement=function(t){this.element=t;let form=this;$(t).find('form[data-autosave="true"] input[type="checkbox"]').click(function(){form.submit()});$(t).find('.or-form-btn--cancel').click(function(){form.cancel()});$(t).find('.or-form-btn--reset').click(function(){form.rollback()});$(t).submit(function(t){if($(this).data('target')=='view'){form.submit();t.preventDefault()}})};this.cancel=function(){this.close()};this.rollback=function(){this.element.trigger('reset')};this.close=function(){};this.submit=function(){let status=$('<div class="notice info"><div class="text loader"></div></div>');$('#noticebar').prepend(status);$(status).show();$(this.element).find('.error').removeClass('error');var e=$(this.element).serializeArray(),t={};$(e).each(function(e,r){t[r.name]=r.value});if(!t.id)t.id=Openrat.Workbench.state.id;if(!t.action)t.action=Openrat.Workbench.state.action;let formMethod=$(this.element).attr('method').toUpperCase();if(formMethod=='GET'){this.forwardTo(t.action,t.subaction,t.id,t)}
else{let url='./api/';this.setLoadStatus(!0);url+='';t.output='json';if($(this.element).data('async')||$(this.element).data('async')=='true'){this.close()};let form=this;$.ajax({'type':'POST',url:url,data:t,success:function(t,e,r){form.setLoadStatus(!1);$(status).remove();doResponse(t,e,form.element)},error:function(t,e,r){form.setLoadStatus(!1);$(status).remove();try{let error=jQuery.parseJSON(t.responseText);Openrat.Workbench.notify('','','error',error.error,[error.description])}catch(o){let msg=t.responseText;Openrat.Workbench.notify('','','error','Server Error',[msg])}}});$(form.element).fadeIn()}}};