(function(e){if(typeof exports=='object'&&typeof module=='object'){e(require('../../lib/codemirror'))}
else if(typeof define=='function'&&define.amd){define(['../../lib/codemirror'],e)}
else{e(CodeMirror)}})(function(i){'use strict';var r={addition:'positive',attributes:'attribute',bold:'strong',cite:'keyword',code:'atom',definitionList:'number',deletion:'negative',div:'punctuation',em:'em',footnote:'variable',footCite:'qualifier',header:'header',html:'comment',image:'string',italic:'em',link:'link',linkDefinition:'link',list1:'variable-2',list2:'variable-3',list3:'keyword',notextile:'string-2',pre:'operator',p:'property',quote:'bracket',span:'quote',specialChar:'tag',strong:'strong',sub:'builtin',sup:'builtin',table:'variable-3',tableHeading:'operator'};function f(e,i){i.mode=n.newLayout;i.tableHeading=!1;if(i.layoutType==='definitionList'&&i.spanningLayout&&e.match(t('definitionListEnd'),!1))i.spanningLayout=!1};function s(e,t,i){if(i==='_'){if(e.eat('_'))return l(e,t,'italic',/__/,2);else return l(e,t,'em',/_/,1)};if(i==='*'){if(e.eat('*')){return l(e,t,'bold',/\*\*/,2)};return l(e,t,'strong',/\*/,1)};if(i==='['){if(e.match(/\d+\]/))t.footCite=!0;return a(t)};if(i==='('){var u=e.match(/^(r|tm|c)\)/);if(u)return o(t,r.specialChar)};if(i==='<'&&e.match(/(\w+)[^>]+>[^<]+<\/\1>/))return o(t,r.html);if(i==='?'&&e.eat('?'))return l(e,t,'cite',/\?\?/,2);if(i==='='&&e.eat('='))return l(e,t,'notextile',/==/,2);if(i==='-'&&!e.eat('-'))return l(e,t,'deletion',/-/,1);if(i==='+')return l(e,t,'addition',/\+/,1);if(i==='~')return l(e,t,'sub',/~/,1);if(i==='^')return l(e,t,'sup',/\^/,1);if(i==='%')return l(e,t,'span',/%/,1);if(i==='@')return l(e,t,'code',/@/,1);if(i==='!'){var n=l(e,t,'image',/(?:\([^\)]+\))?!/,1);e.match(/^:\S+/);return n};return a(t)};function l(e,t,i,u,o){var r=e.pos>o?e.string.charAt(e.pos-o-1):null,l=e.peek();if(t[i]){if((!l||/\W/.test(l))&&r&&/\S/.test(r)){var s=a(t);t[i]=!1;return s}}
else if((!r||/\W/.test(r))&&l&&/\S/.test(l)&&e.match(new RegExp('^.*\\S'+u.source+'(?:\\W|$)'),!1)){t[i]=!0;t.mode=n.attributes};return a(t)};function a(e){var i=u(e);if(i)return i;var t=[];if(e.layoutType)t.push(r[e.layoutType]);t=t.concat(c(e,'addition','bold','cite','code','deletion','em','footCite','image','italic','link','span','strong','sub','sup','table','tableHeading'));if(e.layoutType==='header')t.push(r.header+'-'+e.header);return t.length?t.join(' '):null};function u(e){var t=e.layoutType;switch(t){case'notextile':case'code':case'pre':return r[t];default:if(e.notextile)return r.notextile+(t?(' '+r[t]):'');return null}};function o(e,t){var n=u(e);if(n)return n;var i=a(e);if(t)return i?(i+' '+t):t;else return i};function c(e){var i=[];for(var t=1;t<arguments.length;++t){if(e[arguments[t]])i.push(r[arguments[t]])};return i};function d(e){var i=e.spanningLayout,a=e.layoutType;for(var t in e)if(e.hasOwnProperty(t))delete e[t];e.mode=n.newLayout;if(i){e.layoutType=a;e.spanningLayout=!0}};var e={cache:{},single:{bc:'bc',bq:'bq',definitionList:/- .*?:=+/,definitionListEnd:/.*=:\s*$/,div:'div',drawTable:/\|.*\|/,foot:/fn\d+/,header:/h[1-6]/,html:/\s*<(?:\/)?(\w+)(?:[^>]+)?>(?:[^<]+<\/\1>)?/,link:/[^"]+":\S/,linkDefinition:/\[[^\s\]]+\]\S+/,list:/(?:#+|\*+)/,notextile:'notextile',para:'p',pre:'pre',table:'table',tableCellAttributes:/[\/\\]\d+/,tableHeading:/\|_\./,tableText:/[^"_\*\[\(\?\+~\^%@|-]+/,text:/[^!"_=\*\[\(<\?\+~\^%@-]+/},attributes:{align:/(?:<>|<|>|=)/,selector:/\([^\(][^\)]+\)/,lang:/\[[^\[\]]+\]/,pad:/(?:\(+|\)+){1,2}/,css:/\{[^\}]+\}/},createRe:function(i){switch(i){case'drawTable':return e.makeRe('^',e.single.drawTable,'$');case'html':return e.makeRe('^',e.single.html,'(?:',e.single.html,')*','$');case'linkDefinition':return e.makeRe('^',e.single.linkDefinition,'$');case'listLayout':return e.makeRe('^',e.single.list,t('allAttributes'),'*\\s+');case'tableCellAttributes':return e.makeRe('^',e.choiceRe(e.single.tableCellAttributes,t('allAttributes')),'+\\.');case'type':return e.makeRe('^',t('allTypes'));case'typeLayout':return e.makeRe('^',t('allTypes'),t('allAttributes'),'*\\.\\.?','(\\s+|$)');case'attributes':return e.makeRe('^',t('allAttributes'),'+');case'allTypes':return e.choiceRe(e.single.div,e.single.foot,e.single.header,e.single.bc,e.single.bq,e.single.notextile,e.single.pre,e.single.table,e.single.para);case'allAttributes':return e.choiceRe(e.attributes.selector,e.attributes.css,e.attributes.lang,e.attributes.align,e.attributes.pad);default:return e.makeRe('^',e.single[i])}},makeRe:function(){var i='';for(var t=0;t<arguments.length;++t){var e=arguments[t];i+=(typeof e==='string')?e:e.source};return new RegExp(i)},choiceRe:function(){var i=[arguments[0]];for(var t=1;t<arguments.length;++t){i[t*2-1]='|';i[t*2]=arguments[t]};i.unshift('(?:');i.push(')');return e.makeRe.apply(null,i)}};function t(t){return(e.cache[t]||(e.cache[t]=e.createRe(t)))};var n={newLayout:function(e,i){if(e.match(t('typeLayout'),!1)){i.spanningLayout=!1;return(i.mode=n.blockType)(e,i)};var a;if(!u(i)){if(e.match(t('listLayout'),!1))a=n.list;else if(e.match(t('drawTable'),!1))a=n.table;else if(e.match(t('linkDefinition'),!1))a=n.linkDefinition;else if(e.match(t('definitionList')))a=n.definitionList;else if(e.match(t('html'),!1))a=n.html};return(i.mode=(a||n.text))(e,i)},blockType:function(i,e){var l,r;e.layoutType=null;if(l=i.match(t('type')))r=l[0];else return(e.mode=n.text)(i,e);if(l=r.match(t('header'))){e.layoutType='header';e.header=parseInt(l[0][1])}
else if(r.match(t('bq'))){e.layoutType='quote'}
else if(r.match(t('bc'))){e.layoutType='code'}
else if(r.match(t('foot'))){e.layoutType='footnote'}
else if(r.match(t('notextile'))){e.layoutType='notextile'}
else if(r.match(t('pre'))){e.layoutType='pre'}
else if(r.match(t('div'))){e.layoutType='div'}
else if(r.match(t('table'))){e.layoutType='table'};e.mode=n.attributes;return a(e)},text:function(e,i){if(e.match(t('text')))return a(i);var r=e.next();if(r==='"')return(i.mode=n.link)(e,i);return s(e,i,r)},attributes:function(e,i){i.mode=n.layoutLength;if(e.match(t('attributes')))return o(i,r.attributes);else return a(i)},layoutLength:function(e,t){if(e.eat('.')&&e.eat('.'))t.spanningLayout=!0;t.mode=n.text;return a(t)},list:function(e,i){var l=e.match(t('list'));i.listDepth=l[0].length;var r=(i.listDepth-1)%3;if(!r)i.layoutType='list1';else if(r===1)i.layoutType='list2';else i.layoutType='list3';i.mode=n.attributes;return a(i)},link:function(e,i){i.mode=n.text;if(e.match(t('link'))){e.match(/\S+/);return o(i,r.link)};return a(i)},linkDefinition:function(e,t){e.skipToEnd();return o(t,r.linkDefinition)},definitionList:function(e,i){e.match(t('definitionList'));i.layoutType='definitionList';if(e.match(/\s*$/))i.spanningLayout=!0;else i.mode=n.attributes;return a(i)},html:function(e,t){e.skipToEnd();return o(t,r.html)},table:function(e,t){t.layoutType='table';return(t.mode=n.tableCell)(e,t)},tableCell:function(e,i){if(e.match(t('tableHeading')))i.tableHeading=!0;else e.eat('|');i.mode=n.tableCellAttributes;return a(i)},tableCellAttributes:function(e,i){i.mode=n.tableText;if(e.match(t('tableCellAttributes')))return o(i,r.attributes);else return a(i)},tableText:function(e,i){if(e.match(t('tableText')))return a(i);if(e.peek()==='|'){i.mode=n.tableCell;return a(i)};return s(e,i,e.next())}};i.defineMode('textile',function(){return{startState:function(){return{mode:n.newLayout}},token:function(e,t){if(e.sol())f(e,t);return t.mode(e,t)},blankLine:d}});i.defineMIME('text/x-textile','textile')});