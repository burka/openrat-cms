(function(e){if(typeof exports=='object'&&typeof module=='object')e(require('../../lib/codemirror'));else if(typeof define=='function'&&define.amd)define(['../../lib/codemirror'],e);else e(CodeMirror)})(function(e){'use strict';e.defineMode('crystal',function(e){function r(e,t){return new RegExp((t?'':'^')+'(?:'+e.join('|')+')'+(t?'$':'\\b'))};function t(e,t,n){n.tokenize.push(e);return e(t,n)};var c=/^(?:[-+/%|&^]|\*\*?|[<>]{2})/,s=/^(?:[=!]~|===|<=>|[<>=!]=?|[|&]{2}|~)/,h=/^(?:\[\][?=]?)/,z=/^(?:\.(?:\.{2})?|->|[?:])/,u=/^[a-z_\u009F-\uFFFF][a-zA-Z0-9_\u009F-\uFFFF]*/,o=/^[A-Z_\u009F-\uFFFF][a-zA-Z0-9_\u009F-\uFFFF]*/,b=r(['abstract','alias','as','asm','begin','break','case','class','def','do','else','elsif','end','ensure','enum','extend','for','fun','if','include','instance_sizeof','lib','macro','module','next','of','out','pointerof','private','protected','rescue','return','require','select','sizeof','struct','super','then','type','typeof','uninitialized','union','unless','until','when','while','with','yield','__DIR__','__END_LINE__','__FILE__','__LINE__']),x=r(['true','false','nil','self']),y=['def','fun','macro','class','module','struct','lib','enum','union','do','for'],g=r(y),I=['if','unless','case','while','until','begin','then'],w=r(I),p=['end','else','elsif','rescue','ensure'],v=r(p),d=['\\)','\\}','\\]'],S=new RegExp('^(?:'+d.join('|')+')$'),k={'def':F,'fun':F,'macro':E,'class':i,'module':i,'struct':i,'lib':i,'enum':i,'union':i};var f={'[':']','{':'}','(':')','<':'>'};function l(e,r){if(e.eatSpace()){return null};if(r.lastToken!='\\'&&e.match('{%',!1)){return t(n('%','%'),e,r)};if(r.lastToken!='\\'&&e.match('{{',!1)){return t(n('{','}'),e,r)};if(e.peek()=='#'){e.skipToEnd();return'comment'};var i;if(e.match(u)){e.eat(/[?!]/);i=e.current();if(e.eat(':')){return'atom'}
else if(r.lastToken=='.'){return'property'}
else if(b.test(i)){if(g.test(i)){if(!(i=='fun'&&r.blocks.indexOf('lib')>=0)&&!(i=='def'&&r.lastToken=='abstract')){r.blocks.push(i);r.currentIndent+=1}}
else if((r.lastStyle=='operator'||!r.lastStyle)&&w.test(i)){r.blocks.push(i);r.currentIndent+=1}
else if(i=='end'){r.blocks.pop();r.currentIndent-=1};if(k.hasOwnProperty(i)){r.tokenize.push(k[i])};return'keyword'}
else if(x.test(i)){return'atom'};return'variable'};if(e.eat('@')){if(e.peek()=='['){return t(a('[',']','meta'),e,r)};e.eat('@');e.match(u)||e.match(o);return'variable-2'};if(e.match(o)){return'tag'};if(e.eat(':')){if(e.eat('"')){return t(m('"','atom',!1),e,r)}
else if(e.match(u)||e.match(o)||e.match(c)||e.match(s)||e.match(h)){return'atom'};e.eat(':');return'operator'};if(e.eat('"')){return t(m('"','string',!0),e,r)};if(e.peek()=='%'){var d='string',p=!0,l;if(e.match('%r')){d='string-2';l=e.next()}
else if(e.match('%w')){p=!1;l=e.next()}
else if(e.match('%q')){p=!1;l=e.next()}
else{if(l=e.match(/^%([^\w\s=])/)){l=l[1]}
else if(e.match(/^%[a-zA-Z0-9_\u009F-\uFFFF]*/)){return'meta'}
else{return'operator'}};if(f.hasOwnProperty(l)){l=f[l]};return t(m(l,d,p),e,r)};if(i=e.match(/^<<-('?)([A-Z]\w*)\1/)){return t(A(i[2],!i[1]),e,r)};if(e.eat('\'')){e.match(/^(?:[^']|\\(?:[befnrtv0'"]|[0-7]{3}|u(?:[0-9a-fA-F]{4}|\{[0-9a-fA-F]{1,6}\})))/);e.eat('\'');return'atom'};if(e.eat('0')){if(e.eat('x')){e.match(/^[0-9a-fA-F]+/)}
else if(e.eat('o')){e.match(/^[0-7]+/)}
else if(e.eat('b')){e.match(/^[01]+/)};return'number'};if(e.eat(/^\d/)){e.match(/^\d*(?:\.\d+)?(?:[eE][+-]?\d+)?/);return'number'};if(e.match(c)){e.eat('=');return'operator'};if(e.match(s)||e.match(z)){return'operator'};if(i=e.match(/[({[]/,!1)){i=i[0];return t(a(i,f[i],null),e,r)};if(e.eat('\\')){e.next();return'meta'};e.next();return null};function a(e,t,n,r){return function(i,u){if(!r&&i.match(e)){u.tokenize[u.tokenize.length-1]=a(e,t,n,!0);u.currentIndent+=1;return n};var o=l(i,u);if(i.current()===t){u.tokenize.pop();u.currentIndent-=1;o=n};return o}};function n(e,t,r){return function(i,u){if(!r&&i.match('{'+e)){u.currentIndent+=1;u.tokenize[u.tokenize.length-1]=n(e,t,!0);return'meta'};if(i.match(t+'}')){u.currentIndent-=1;u.tokenize.pop();return'meta'};return l(i,u)}};function E(e,t){if(e.eatSpace()){return null};var n;if(n=e.match(u)){if(n=='def'){return'keyword'};e.eat(/[?!]/)};t.tokenize.pop();return'def'};function F(e,t){if(e.eatSpace()){return null};if(e.match(u)){e.eat(/[!?]/)}
else{e.match(c)||e.match(s)||e.match(h)};t.tokenize.pop();return'def'};function i(e,t){if(e.eatSpace()){return null};e.match(o);t.tokenize.pop();return'def'};function m(t,e,r){return function(i,u){var o=!1;while(i.peek()){if(!o){if(i.match('{%',!1)){u.tokenize.push(n('%','%'));return e};if(i.match('{{',!1)){u.tokenize.push(n('{','}'));return e};if(r&&i.match('#{',!1)){u.tokenize.push(a('#{','}','meta'));return e};var f=i.next();if(f==t){u.tokenize.pop();return e};o=r&&f=='\\'}
else{i.next();o=!1}};return e}};function A(e,t){return function(r,i){if(r.sol()){r.eatSpace();if(r.match(e)){i.tokenize.pop();return'string'}};var u=!1;while(r.peek()){if(!u){if(r.match('{%',!1)){i.tokenize.push(n('%','%'));return'string'};if(r.match('{{',!1)){i.tokenize.push(n('{','}'));return'string'};if(t&&r.match('#{',!1)){i.tokenize.push(a('#{','}','meta'));return'string'};u=t&&r.next()=='\\'}
else{r.next();u=!1}};return'string'}};return{startState:function(){return{tokenize:[l],currentIndent:0,lastToken:null,lastStyle:null,blocks:[]}},token:function(e,t){var n=t.tokenize[t.tokenize.length-1](e,t),r=e.current();if(n&&n!='comment'){t.lastToken=r;t.lastStyle=n};return n},indent:function(t,n){n=n.replace(/^\s*(?:\{%)?\s*|\s*(?:%\})?\s*$/g,'');if(v.test(n)||S.test(n)){return e.indentUnit*(t.currentIndent-1)};return e.indentUnit*t.currentIndent},fold:'indent',electricInput:r(d.concat(p),!0),lineComment:'#'}});e.defineMIME('text/x-crystal','crystal')});