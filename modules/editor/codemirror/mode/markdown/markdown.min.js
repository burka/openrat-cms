(function(t){if(typeof exports=='object'&&typeof module=='object')t(require('../../lib/codemirror'),require('../xml/xml'),require('../meta'));else if(typeof define=='function'&&define.amd)define(['../../lib/codemirror','../xml/xml','../meta'],t);else t(CodeMirror)})(function(t){'use strict';t.defineMode('markdown',function(r,e){var o=t.getMode(r,'text/html'),E=o.name=='null';function w(e){if(t.findModeByName){var i=t.findModeByName(e);if(i)e=i.mime||i.mimes[0]};var n=t.getMode(r,e);return n.name=='null'?null:n};if(e.highlightFormatting===undefined)e.highlightFormatting=!1;if(e.maxBlockquoteDepth===undefined)e.maxBlockquoteDepth=0;if(e.taskLists===undefined)e.taskLists=!1;if(e.strikethrough===undefined)e.strikethrough=!1;if(e.emoji===undefined)e.emoji=!1;if(e.fencedCodeBlockHighlighting===undefined)e.fencedCodeBlockHighlighting=!0;if(e.xml===undefined)e.xml=!0;if(e.tokenTypeOverrides===undefined)e.tokenTypeOverrides={};var i={header:'header',code:'comment',quote:'quote',list1:'variable-2',list2:'variable-3',list3:'keyword',hr:'hr',image:'image',imageAltText:'image-alt-text',imageMarker:'image-marker',formatting:'formatting',linkInline:'link',linkEmail:'link',linkText:'link',linkHref:'string',em:'em',strong:'strong',strikethrough:'strikethrough',emoji:'builtin'};for(var h in i){if(i.hasOwnProperty(h)&&e.tokenTypeOverrides[h]){i[h]=e.tokenTypeOverrides[h]}};var x=/^([*\-_])(?:\s*\1){2,}\s*$/,v=/^(?:[*\-+]|^[0-9]+([.)]))\s+/,m=/^\[(x| )\](?=\s)/i,L=e.allowAtxHeaderWithoutSpace?/^(#+)/:/^(#+)(?: |$)/,T=/^ *(?:\={1,}|-{1,})\s*$/,q=/^[^#!\[\]*_\\<>` "'(~:]+/,M=/^(~~~+|```+)[ \t]*([\w+#-]*)[^\n`]*$/,F=/^\s*\[[^\]]+?\]:\s*\S+(\s*\S*\s*)?$/,l=/[!"#$%&'()*+,\-\.\/:;<=>?@\[\\\]^_`{|}~â€”]/,b='    ';function g(t,e,i){e.f=e.inline=i;return i(t,e)};function d(t,e,i){e.f=e.block=i;return i(t,e)};function y(t){return!t||!/\S/.test(t.string)};function c(t){t.linkTitle=!1;t.em=!1;t.strong=!1;t.strikethrough=!1;t.quote=0;t.indentedCode=!1;if(t.f==s){t.f=a;t.block=f};t.trailingSpace=0;t.trailingSpaceNewLine=!1;t.prevLine=t.thisLine;t.thisLine={stream:null};return null};function f(a,r){var f=a.column()===r.indentation,u=y(r.prevLine.stream),c=r.indentedCode,k=r.prevLine.hr,d=r.list!==!1,o=(r.listStack[r.listStack.length-1]||0)+3;r.indentedCode=!1;var h=r.indentation;if(r.indentationDiff===null){r.indentationDiff=r.indentation;if(d){r.list=null;while(h<r.listStack[r.listStack.length-1]){r.listStack.pop();if(r.listStack.length){r.indentation=r.listStack[r.listStack.length-1]}
else{r.list=!1}};if(r.list!==!1){r.indentationDiff=h-r.listStack[r.listStack.length-1]}}};var S=(!u&&!k&&!r.prevLine.header&&(!d||!c)&&!r.prevLine.fencedCodeEnd),s=(r.list===!1||k||u)&&r.indentation<=o&&a.match(x),l=null;if(r.indentationDiff>=4&&(c||r.prevLine.fencedCodeEnd||r.prevLine.header||u)){a.skipToEnd();r.indentedCode=!0;return i.code}
else if(a.eatSpace()){return null}
else if(f&&r.indentation<=o&&(l=a.match(L))&&l[1].length<=6){r.quote=0;r.header=l[1].length;r.thisLine.header=!0;if(e.highlightFormatting)r.formatting='header';r.f=r.inline;return n(r)}
else if(r.indentation<=o&&a.eat('>')){r.quote=f?1:r.quote+1;if(e.highlightFormatting)r.formatting='quote';a.eatSpace();return n(r)}
else if(!s&&!r.setext&&f&&r.indentation<=o&&(l=a.match(v))){var p=l[1]?'ol':'ul';r.indentation=h+a.current().length;r.list=!0;r.quote=0;r.listStack.push(r.indentation);if(e.taskLists&&a.match(m,!1)){r.taskList=!0};r.f=r.inline;if(e.highlightFormatting)r.formatting=['list','list-'+p];return n(r)}
else if(f&&r.indentation<=o&&(l=a.match(M,!0))){r.quote=0;r.fencedEndRE=new RegExp(l[1]+'+ *$');r.localMode=e.fencedCodeBlockHighlighting&&w(l[2]);if(r.localMode)r.localState=t.startState(r.localMode);r.f=r.block=j;if(e.highlightFormatting)r.formatting='code-block';r.code=-1;return n(r)}
else if(r.setext||((!S||!d)&&!r.quote&&r.list===!1&&!r.code&&!s&&!F.test(a.string)&&(l=a.lookAhead(1))&&(l=l.match(T)))){if(!r.setext){r.header=l[0].charAt(0)=='='?1:2;r.setext=r.header}
else{r.header=r.setext;r.setext=0;a.skipToEnd();if(e.highlightFormatting)r.formatting='header'};r.thisLine.header=!0;r.f=r.inline;return n(r)}
else if(s){a.skipToEnd();r.hr=!0;r.thisLine.hr=!0;return i.hr}
else if(a.peek()==='['){return g(a,r,H)};return g(a,r,r.inline)};function s(e,i){var r=o.token(e,i.htmlState);if(!E){var n=t.innerMode(o,i.htmlState);if((n.mode.name=='xml'&&n.state.tagStart===null&&(!n.state.context&&n.state.tokenize.isInText))||(i.md_inside&&e.current().indexOf('>')>-1)){i.f=a;i.block=f;i.htmlState=null}};return r};function j(r,t){var s=t.listStack[t.listStack.length-1]||0,l=t.indentation<s,h=s+3;if(t.fencedEndRE&&t.indentation<=h&&(l||r.match(t.fencedEndRE))){if(e.highlightFormatting)t.formatting='code-block';var o;if(!l)o=n(t);t.localMode=t.localState=null;t.block=f;t.f=a;t.fencedEndRE=null;t.code=0;t.thisLine.fencedCodeEnd=!0;if(l)return d(r,t,t.block);return o}
else if(t.localMode){return t.localMode.token(r,t.localState)}
else{r.skipToEnd();return i.code}};function n(t){var n=[];if(t.formatting){n.push(i.formatting);if(typeof t.formatting==='string')t.formatting=[t.formatting];for(var r=0;r<t.formatting.length;r++){n.push(i.formatting+'-'+t.formatting[r]);if(t.formatting[r]==='header'){n.push(i.formatting+'-'+t.formatting[r]+'-'+t.header)};if(t.formatting[r]==='quote'){if(!e.maxBlockquoteDepth||e.maxBlockquoteDepth>=t.quote){n.push(i.formatting+'-'+t.formatting[r]+'-'+t.quote)}
else{n.push('error')}}}};if(t.taskOpen){n.push('meta');return n.length?n.join(' '):null};if(t.taskClosed){n.push('property');return n.length?n.join(' '):null};if(t.linkHref){n.push(i.linkHref,'url')}
else{if(t.strong){n.push(i.strong)};if(t.em){n.push(i.em)};if(t.strikethrough){n.push(i.strikethrough)};if(t.emoji){n.push(i.emoji)};if(t.linkText){n.push(i.linkText)};if(t.code){n.push(i.code)};if(t.image){n.push(i.image)};if(t.imageAltText){n.push(i.imageAltText,'link')};if(t.imageMarker){n.push(i.imageMarker)}};if(t.header){n.push(i.header,i.header+'-'+t.header)};if(t.quote){n.push(i.quote);if(!e.maxBlockquoteDepth||e.maxBlockquoteDepth>=t.quote){n.push(i.quote+'-'+t.quote)}
else{n.push(i.quote+'-'+e.maxBlockquoteDepth)}};if(t.list!==!1){var a=(t.listStack.length-1)%3;if(!a){n.push(i.list1)}
else if(a===1){n.push(i.list2)}
else{n.push(i.list3)}};if(t.trailingSpaceNewLine){n.push('trailing-space-new-line')}
else if(t.trailingSpace){n.push('trailing-space-'+(t.trailingSpace%2?'a':'b'))};return n.length?n.join(' '):null};function C(t,e){if(t.match(q,!0)){return n(e)};return undefined};function a(f,r){var w=r.text(f,r);if(typeof w!=='undefined')return w;if(r.list){r.list=null;return n(r)};if(r.taskList){var H=f.match(m,!0)[1]===' ';if(H)r.taskOpen=!0;else r.taskClosed=!0;if(e.highlightFormatting)r.formatting='task';r.taskList=!1;return n(r)};r.taskOpen=!1;r.taskClosed=!1;if(r.header&&f.match(/^#+$/,!0)){if(e.highlightFormatting)r.formatting='header';return n(r)};var h=f.next();if(r.linkTitle){r.linkTitle=!1;var L=h;if(h==='('){L=')'};L=(L+'').replace(/([.?*+^\[\]\\(){}|-])/g,'\\$1');var B='^\\s*(?:[^'+L+'\\\\]+|\\\\\\\\|\\\\.)'+L;if(f.match(new RegExp(B),!0)){return i.linkHref}};if(h==='`'){var C=r.formatting;if(e.highlightFormatting)r.formatting='code';f.eatWhile('`');var F=f.current().length;if(r.code==0&&(!r.quote||F==1)){r.code=F;return n(r)}
else if(F==r.code){var v=n(r);r.code=0;return v}
else{r.formatting=C;return n(r)}}
else if(r.code){return n(r)};if(h==='\\'){f.next();if(e.highlightFormatting){var g=n(r),E=i.formatting+'-escape';return g?g+' '+E:E}};if(h==='!'&&f.match(/\[[^\]]*\] ?(?:\(|\[)/,!1)){r.imageMarker=!0;r.image=!0;if(e.highlightFormatting)r.formatting='image';return n(r)};if(h==='['&&r.imageMarker&&f.match(/[^\]]*\](\(.*?\)| ?\[.*?\])/,!1)){r.imageMarker=!1;r.imageAltText=!0;if(e.highlightFormatting)r.formatting='image';return n(r)};if(h===']'&&r.imageAltText){if(e.highlightFormatting)r.formatting='image';var g=n(r);r.imageAltText=!1;r.image=!1;r.inline=r.f=p;return g};if(h==='['&&!r.image){r.linkText=!0;if(e.highlightFormatting)r.formatting='link';return n(r)};if(h===']'&&r.linkText){if(e.highlightFormatting)r.formatting='link';var g=n(r);r.linkText=!1;r.inline=r.f=f.match(/\(.*?\)| ?\[.*?\]/,!1)?p:a;return g};if(h==='<'&&f.match(/^(https?|ftps?):\/\/(?:[^\\>]|\\.)+>/,!1)){r.f=r.inline=k;if(e.highlightFormatting)r.formatting='link';var g=n(r);if(g){g+=' '}
else{g=''};return g+i.linkInline};if(h==='<'&&f.match(/^[^> \\]+@(?:[^\\>]|\\.)+>/,!1)){r.f=r.inline=k;if(e.highlightFormatting)r.formatting='link';var g=n(r);if(g){g+=' '}
else{g=''};return g+i.linkEmail};if(e.xml&&h==='<'&&f.match(/^(!--|[a-z]+(?:\s+[a-z_:.\-]+(?:\s*=\s*[^ >]+)?)*\s*>)/i,!1)){var b=f.string.indexOf('>',f.pos);if(b!=-1){var j=f.string.substring(f.start,b);if(/markdown\s*=\s*('|"){0,1}1('|"){0,1}/.test(j))r.md_inside=!0};f.backUp(1);r.htmlState=t.startState(o);return d(f,r,s)};if(e.xml&&h==='<'&&f.match(/^\/\w*?>/)){r.md_inside=!1;return'tag'}
else if(h==='*'||h==='_'){var M=1,x=f.pos==1?' ':f.string.charAt(f.pos-2);while(M<3&&f.eat(h))M++;var u=f.peek()||' ',T=!/\s/.test(u)&&(!l.test(u)||/\s/.test(x)||l.test(x)),q=!/\s/.test(x)&&(!l.test(x)||/\s/.test(u)||l.test(u)),c=null,S=null;if(M%2){if(!r.em&&T&&(h==='*'||!q||l.test(x)))c=!0;else if(r.em==h&&q&&(h==='*'||!T||l.test(u)))c=!1};if(M>1){if(!r.strong&&T&&(h==='*'||!q||l.test(x)))S=!0;else if(r.strong==h&&q&&(h==='*'||!T||l.test(u)))S=!1};if(S!=null||c!=null){if(e.highlightFormatting)r.formatting=c==null?'strong':S==null?'em':'strong em';if(c===!0)r.em=h;if(S===!0)r.strong=h;var v=n(r);if(c===!1)r.em=!1;if(S===!1)r.strong=!1;return v}}
else if(h===' '){if(f.eat('*')||f.eat('_')){if(f.peek()===' '){return n(r)}
else{f.backUp(1)}}};if(e.strikethrough){if(h==='~'&&f.eatWhile(h)){if(r.strikethrough){if(e.highlightFormatting)r.formatting='strikethrough';var v=n(r);r.strikethrough=!1;return v}
else if(f.match(/^[^\s]/,!1)){r.strikethrough=!0;if(e.highlightFormatting)r.formatting='strikethrough';return n(r)}}
else if(h===' '){if(f.match(/^~~/,!0)){if(f.peek()===' '){return n(r)}
else{f.backUp(2)}}}};if(e.emoji&&h===':'&&f.match(/^[a-z_\d+-]+:/)){r.emoji=!0;if(e.highlightFormatting)r.formatting='emoji';var y=n(r);r.emoji=!1;return y};if(h===' '){if(f.match(/ +$/,!1)){r.trailingSpace++}
else if(r.trailingSpace){r.trailingSpaceNewLine=!0}};return n(r)};function k(t,r){var o=t.next();if(o==='>'){r.f=r.inline=a;if(e.highlightFormatting)r.formatting='link';var l=n(r);if(l){l+=' '}
else{l=''};return l+i.linkInline};t.match(/^[^>]+/,!0);return i.linkInline};function p(t,i){if(t.eatSpace()){return null};var r=t.next();if(r==='('||r==='['){i.f=i.inline=B(r==='('?')':']');if(e.highlightFormatting)i.formatting='link-string';i.linkHref=!0;return n(i)};return'error'};var S={')':/^(?:[^\\\(\)]|\\.|\((?:[^\\\(\)]|\\.)*\))*?(?=\))/,']':/^(?:[^\\\[\]]|\\.|\[(?:[^\\\[\]]|\\.)*\])*?(?=\])/};function B(t){return function(i,r){var o=i.next();if(o===t){r.f=r.inline=a;if(e.highlightFormatting)r.formatting='link-string';var l=n(r);r.linkHref=!1;return l};i.match(S[t]);r.linkHref=!0;return n(r)}};function H(t,i){if(t.match(/^([^\]\\]|\\.)*\]:/,!1)){i.f=D;t.next();if(e.highlightFormatting)i.formatting='link';i.linkText=!0;return n(i)};return g(t,i,a)};function D(t,r){if(t.match(/^\]:/,!0)){r.f=r.inline=A;if(e.highlightFormatting)r.formatting='link';var a=n(r);r.linkText=!1;return a};t.match(/^([^\]\\]|\\.)+/,!0);return i.linkText};function A(t,e){if(t.eatSpace()){return null};t.match(/^[^\s]+/,!0);if(t.peek()===undefined){e.linkTitle=!0}
else{t.match(/^(?:\s+(?:"(?:[^"\\]|\\\\|\\.)+"|'(?:[^'\\]|\\\\|\\.)+'|\((?:[^)\\]|\\\\|\\.)+\)))?/,!0)};e.f=e.inline=a;return i.linkHref+' url'};var u={startState:function(){return{f:f,prevLine:{stream:null},thisLine:{stream:null},block:f,htmlState:null,indentation:0,inline:a,text:C,formatting:!1,linkText:!1,linkHref:!1,linkTitle:!1,code:0,em:!1,strong:!1,header:0,setext:0,hr:!1,taskList:!1,list:!1,listStack:[],quote:0,trailingSpace:0,trailingSpaceNewLine:!1,strikethrough:!1,emoji:!1,fencedEndRE:null}},copyState:function(e){return{f:e.f,prevLine:e.prevLine,thisLine:e.thisLine,block:e.block,htmlState:e.htmlState&&t.copyState(o,e.htmlState),indentation:e.indentation,localMode:e.localMode,localState:e.localMode?t.copyState(e.localMode,e.localState):null,inline:e.inline,text:e.text,formatting:!1,linkText:e.linkText,linkTitle:e.linkTitle,code:e.code,em:e.em,strong:e.strong,strikethrough:e.strikethrough,emoji:e.emoji,header:e.header,setext:e.setext,hr:e.hr,taskList:e.taskList,list:e.list,listStack:e.listStack.slice(0),quote:e.quote,indentedCode:e.indentedCode,trailingSpace:e.trailingSpace,trailingSpaceNewLine:e.trailingSpaceNewLine,md_inside:e.md_inside,fencedEndRE:e.fencedEndRE}},token:function(e,t){t.formatting=!1;if(e!=t.thisLine.stream){t.header=0;t.hr=!1;if(e.match(/^\s*$/,!0)){c(t);return null};t.prevLine=t.thisLine;t.thisLine={stream:e};t.taskList=!1;t.trailingSpace=0;t.trailingSpaceNewLine=!1;if(!t.localState){t.f=t.block;if(t.f!=s){var i=e.match(/^\s*/,!0)[0].replace(/\t/g,b).length;t.indentation=i;t.indentationDiff=null;if(i>0)return null}}};return t.f(e,t)},innerMode:function(t){if(t.block==s)return{state:t.htmlState,mode:o};if(t.localState)return{state:t.localState,mode:t.localMode};return{state:t,mode:u}},indent:function(e,i,n){if(e.block==s&&o.indent)return o.indent(e.htmlState,i,n);if(e.localState&&e.localMode.indent)return e.localMode.indent(e.localState,i,n);return t.Pass},blankLine:c,getType:n,closeBrackets:'()[]{}\'\'""``',fold:'markdown'};return u},'xml');t.defineMIME('text/x-markdown','markdown')});