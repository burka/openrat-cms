(function(e){if(typeof exports=='object'&&typeof module=='object')e(require('../../lib/codemirror'));else if(typeof define=='function'&&define.amd)define(['../../lib/codemirror'],e);else e(CodeMirror)})(function(e){'use strict';e.defineMode('ruby',function(e){function a(e){var n={};for(var t=0,i=e.length;t<i;++t)n[e[t]]=!0;return n};var l=a(['alias','and','BEGIN','begin','break','case','class','def','defined?','do','else','elsif','END','end','ensure','false','for','if','in','module','next','not','or','redo','rescue','retry','return','self','super','then','true','undef','unless','until','when','while','yield','nil','raise','throw','catch','fail','loop','callcc','caller','lambda','proc','public','protected','private','require','load','require_relative','extend','autoload','__END__','__FILE__','__LINE__','__dir__']),u=a(['def','class','case','for','while','until','module','then','catch','loop','proc','begin']),s=a(['end','until']),o={'[':']','{':'}','(':')'};var t;function n(e,t,n){n.tokenize.push(e);return e(t,n)};function r(e,a){if(e.sol()&&e.match('=begin')&&e.eol()){a.tokenize.push(k);return'comment'};if(e.eatSpace())return null;var r=e.next(),s;if(r=='`'||r=='\''||r=='"'){return n(i(r,'string',r=='"'||r=='`'),e,a)}
else if(r=='/'){if(d(e))return n(i(r,'string-2',!0),e,a);else return'operator'}
else if(r=='%'){var l='string',u=!0;if(e.eat('s'))l='atom';else if(e.eat(/[WQ]/))l='string';else if(e.eat(/[r]/))l='string-2';else if(e.eat(/[wxq]/)){l='string';u=!1};var f=e.eat(/[^\w\s=]/);if(!f)return'operator';if(o.propertyIsEnumerable(f))f=o[f];return n(i(f,l,u,!0),e,a)}
else if(r=='#'){e.skipToEnd();return'comment'}
else if(r=='<'&&(s=e.match(/^<-?[\`"']?([a-zA-Z_?]\w*)[\`"']?(?:;|$)/))){return n(p(s[1]),e,a)}
else if(r=='0'){if(e.eat('x'))e.eatWhile(/[\da-fA-F]/);else if(e.eat('b'))e.eatWhile(/[01]/);else e.eatWhile(/[0-7]/);return'number'}
else if(/\d/.test(r)){e.match(/^[\d_]*(?:\.[\d_]+)?(?:[eE][+\-]?[\d_]+)?/);return'number'}
else if(r=='?'){while(e.match(/^\\[CM]-/)){};if(e.eat('\\'))e.eatWhile(/\w/);else e.next();return'string'}
else if(r==':'){if(e.eat('\''))return n(i('\'','atom',!1),e,a);if(e.eat('"'))return n(i('"','atom',!0),e,a);if(e.eat(/[\<\>]/)){e.eat(/[\<\>]/);return'atom'};if(e.eat(/[\+\-\*\/\&\|\:\!]/)){return'atom'};if(e.eat(/[a-zA-Z$@_\xa1-\uffff]/)){e.eatWhile(/[\w$\xa1-\uffff]/);e.eat(/[\?\!\=]/);return'atom'};return'operator'}
else if(r=='@'&&e.match(/^@?[a-zA-Z_\xa1-\uffff]/)){e.eat('@');e.eatWhile(/[\w\xa1-\uffff]/);return'variable-2'}
else if(r=='$'){if(e.eat(/[a-zA-Z_]/)){e.eatWhile(/[\w]/)}
else if(e.eat(/\d/)){e.eat(/\d/)}
else{e.next()};return'variable-3'}
else if(/[a-zA-Z_\xa1-\uffff]/.test(r)){e.eatWhile(/[\w\xa1-\uffff]/);e.eat(/[\?\!]/);if(e.eat(':'))return'atom';return'ident'}
else if(r=='|'&&(a.varList||a.lastTok=='{'||a.lastTok=='do')){t='|';return null}
else if(/[\(\)\[\]{}\\;]/.test(r)){t=r;return null}
else if(r=='-'&&e.eat('>')){return'arrow'}
else if(/[=+\-\/*:\.^%<>~|]/.test(r)){var c=e.eatWhile(/[=+\-\/*:\.^%<>~|]/);if(r=='.'&&!c)t='.';return'operator'}
else{return null}};function d(e){var o=e.pos,n=0,t,r=!1,i=!1;while((t=e.next())!=null){if(!i){if('[{('.indexOf(t)>-1){n++}
else if(']})'.indexOf(t)>-1){n--;if(n<0)break}
else if(t=='/'&&n==0){r=!0;break};i=t=='\\'}
else{i=!1}};e.backUp(e.pos-o);return r};function f(e){if(!e)e=1;return function(t,n){if(t.peek()=='}'){if(e==1){n.tokenize.pop();return n.tokenize[n.tokenize.length-1](t,n)}
else{n.tokenize[n.tokenize.length-1]=f(e-1)}}
else if(t.peek()=='{'){n.tokenize[n.tokenize.length-1]=f(e+1)};return r(t,n)}};function c(){var e=!1;return function(t,n){if(e){n.tokenize.pop();return n.tokenize[n.tokenize.length-1](t,n)};e=!0;return r(t,n)}};function i(e,t,n,i){return function(r,o){var a=!1,l;if(o.context.type==='read-quoted-paused'){o.context=o.context.prev;r.eat('}')}
while((l=r.next())!=null){if(l==e&&(i||!a)){o.tokenize.pop();break};if(n&&l=='#'&&!a){if(r.eat('{')){if(e=='}'){o.context={prev:o.context,type:'read-quoted-paused'}};o.tokenize.push(f());break}
else if(/[@\$]/.test(r.peek())){o.tokenize.push(c());break}};a=!a&&l=='\\'};return t}};function p(e){return function(t,n){if(t.match(e))n.tokenize.pop();else t.skipToEnd();return'string'}};function k(e,t){if(e.sol()&&e.match('=end')&&e.eol())t.tokenize.pop();e.skipToEnd();return'comment'};return{startState:function(){return{tokenize:[r],indented:0,context:{type:'top',indented:-e.indentUnit},continuedLine:!1,lastTok:null,varList:!1}},token:function(n,e){t=null;if(n.sol())e.indented=n.indentation();var i=e.tokenize[e.tokenize.length-1](n,e),o,a=t;if(i=='ident'){var r=n.current();i=e.lastTok=='.'?'property':l.propertyIsEnumerable(n.current())?'keyword':/^[A-Z]/.test(r)?'tag':(e.lastTok=='def'||e.lastTok=='class'||e.varList)?'def':'variable';if(i=='keyword'){a=r;if(u.propertyIsEnumerable(r))o='indent';else if(s.propertyIsEnumerable(r))o='dedent';else if((r=='if'||r=='unless')&&n.column()==n.indentation())o='indent';else if(r=='do'&&e.context.indented<e.indented)o='indent'}};if(t||(i&&i!='comment'))e.lastTok=a;if(t=='|')e.varList=!e.varList;if(o=='indent'||/[\(\[\{]/.test(t))e.context={prev:e.context,type:t||i,indented:e.indented};else if((o=='dedent'||/[\)\]\}]/.test(t))&&e.context.prev)e.context=e.context.prev;if(n.eol())e.continuedLine=(t=='\\'||i=='operator');return i},indent:function(t,n){if(t.tokenize[t.tokenize.length-1]!=r)return 0;var a=n&&n.charAt(0),i=t.context,f=i.type==o[a]||i.type=='keyword'&&/^(?:end|until|else|elsif|when|rescue)\b/.test(n);return i.indented+(f?0:e.indentUnit)+(t.continuedLine?e.indentUnit:0)},electricInput:/^\s*(?:end|rescue|elsif|else|\})$/,lineComment:'#',fold:'indent'}});e.defineMIME('text/x-ruby','ruby')});